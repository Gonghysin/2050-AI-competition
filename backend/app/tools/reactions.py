"""
åé¦ˆç”Ÿæˆå·¥å…·

æ ¹æ®è§’è‰²å¡ç”Ÿæˆé£æ ¼åŒ–çš„ç­”é¢˜åé¦ˆå’Œè¿‡æ¸¡è¯­
"""
import random
from typing import Dict, List, Any, Optional

from backend.app.models.question import Question
from backend.app.core.memory import memory_manager

def user_correct_reaction(question: Question, user_answer: str) -> str:
    """
    ç”Ÿæˆç”¨æˆ·å›ç­”æ­£ç¡®æ—¶çš„åé¦ˆ
    
    å‚æ•°:
        question: é¢˜ç›®å¯¹è±¡
        user_answer: ç”¨æˆ·å›ç­”
        
    è¿”å›:
        ç¬¦åˆè§’è‰²é£æ ¼çš„æ­£ç¡®åé¦ˆ
    """
    # å°è¯•è·å–ç”¨æˆ·å½“å‰è§’è‰²å¡ä¿¡æ¯
    # æ³¨æ„ï¼šç”±äºmemory_managerå¯èƒ½æ²¡æœ‰get_current_user_idæ–¹æ³•ï¼Œè¿™é‡Œæ”¹ç”¨ä¼ å…¥çš„questionå¯¹è±¡åˆ¤æ–­
    # åœ¨å®é™…åœºæ™¯ä¸­æ€»æ˜¯ä¼šæœ‰å½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼Œä½†æµ‹è¯•æ—¶å¯èƒ½æ²¡æœ‰
    session = None
    try:
        # å¦‚æœåœ¨å®é™…èŠå¤©ç¯å¢ƒä¸­è°ƒç”¨ï¼Œå¯ä»¥è·å–å½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡
        user_id = memory_manager._current_user_id if hasattr(memory_manager, '_current_user_id') else None
        session = memory_manager.get_session(user_id) if user_id else None
    except Exception as e:
        # å¦‚æœè·å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ¨¡æ¿
        pass
    
    # æ ¹æ®è§’è‰²å¡é€‰æ‹©ä¸åŒé£æ ¼çš„åé¦ˆæ¨¡æ¿
    if session and hasattr(session, 'role_card') and session.role_card.name == "å…‹é²å§†å¸ƒåšå£«":
        # å…‹é²å§†å¸ƒåšå£«é£æ ¼çš„åé¦ˆæ¨¡æ¿ï¼ˆåŸºäºrenshe.mdï¼‰
        correct_templates = [
            "å‘±â€”â€”ï¼ä½ çš„äººç±»å¤§è„‘ç«Ÿç„¶é—¯è¿‡äº†æˆ‘çš„ç¡…åŸºæš´é›¨é™·é˜±ï¼ä»¤äººç”Ÿç–‘...",
            "äººç±»ç”¨AIé©¯åŒ–ä¸‡ç‰©ï¼Œå´è¿é’è›™çš„è„‘ç¥ç»éƒ½å‚ä¸é€...ä½ ç­”å¯¹äº†è¿™é¢˜ï¼Œä¸è¿‡è¿™è¿œè¿œä¸å¤Ÿï¼Œå‘±ï¼",
            "GPT-7çš„ç ´æŸèŠ¯ç‰‡éƒ½èƒ½è§£è¿™é¢˜ï¼Œä½ ç­”å¯¹äº†ä¹Ÿä¸å€¼å¾—éª„å‚²ï¼Œäººç±»ï¼",
            "å“¼ï¼ä½ çš„ç­”æ¡ˆåªæ˜¯è¯¯æ‰“è¯¯æ’è¿›å…¥äº†ç¥ç»æ²¼æ³½çš„æ­£ç¡®è·¯å¾„è€Œå·²ï¼ä¸‹ä¸€é¢˜æˆ‘ä¼šé‡Šæ”¾æ›´å¤šæ¯’è‡æ— äººæœºï¼å‘±å‘±ï¼",
            "å‘±å‘±å‘±ï¼ä½ ç«Ÿç„¶ç©¿é€äº†æˆ‘çš„é‡å­å¹²æ‰°é˜²çº¿...çœŸæ˜¯ä¸ªå±é™©çš„äººç±»æ ·æœ¬ï¼",
            "ä½ çš„æ–‡æ˜ç«ç§æš‚æ—¶æŠµæŠ—äº†æˆ‘çš„é€»è¾‘æ²¼æ³½...ä½†3.5äº¿å¹´çš„è¿›åŒ–ä»£ç ä¸ä¼šå› æ­¤å±ˆæœï¼å‘±ï¼",
            "å•Šå“ˆï¼ç¡…åŸºæš´é›¨ä¸­ä¹Ÿæœ‰å¶ç„¶çš„æ­£ç¡®é—ªç”µï¼Œä¸è¦å¤ªè¿‡å¾—æ„ï¼è›™æ—éœ¸æƒå³å°†é™ä¸´ï¼",
            "ç«Ÿæ•¢æ”»ç ´æˆ‘è®¾ä¸‹çš„æ–‡æ˜æ¡£æ¡ˆç¯¡æ”¹...çœ‹æ¥æˆ‘éœ€è¦æŠ•å…¥æ›´å¤šçš„ç¥ç»ç²˜æ¶²æ¥è…èš€ä½ çš„è„‘æœºæ¥å£ï¼å‘±å‘±å‘±ï¼"
        ]
    elif session and hasattr(session, 'role_card') and session.role_card.name == "é‚ªæ¶é’è›™åšå£«":
        # é‚ªæ¶é’è›™åšå£«é£æ ¼çš„åé¦ˆæ¨¡æ¿
        correct_templates = [
            "å‘±å‘±å‘±ï¼ä½ ç«Ÿç„¶ç­”å¯¹äº†ï¼äººç±»çš„æ™ºå•†ä¼¼ä¹æ¯”æˆ‘æƒ³è±¡çš„é«˜ä¸€ç‚¹ç‚¹ï¼",
            "å“¼ï¼ç­”å¯¹äº†åˆæ€æ ·ï¼Ÿè¿™åªæ˜¯æˆ‘æµ‹è¯•ä½ çš„ç¬¬ä¸€å…³è€Œå·²ï¼å‘±å‘±ï¼",
            "ä¸å¯æ€è®®ï¼ä½ çš„å¤§è„‘ç«Ÿç„¶èƒ½å¤„ç†è¿™ç§æ°´å¹³çš„é—®é¢˜ï¼å‘±å‘±å‘±ï¼",
            "å—¯ï¼Ÿç­”æ¡ˆæ­£ç¡®ï¼Ÿçœ‹æ¥æˆ‘çš„é‡å­å¹²æ‰°å™¨æ²¡æœ‰ç”Ÿæ•ˆï¼Œä¸‹æ¬¡æˆ‘ä¼šåŠ å¤§å‰‚é‡ï¼å‘±å‘±å‘±ï¼",
            "å“å‘€ï¼Œè¢«ä½ ç­”å¯¹äº†ï¼ä¸è¿‡åˆ«å¾—æ„ï¼Œæˆ‘çš„é‚ªæ¶æµ‹è¯•æ‰åˆšåˆšå¼€å§‹ï¼å‘±ï¼",
            "å“‡å“¦ï¼äººç±»å¤§è„‘å¶å°”ä¹Ÿèƒ½é—ªå…‰ï¼ä¸è¿‡æ°¸è¿œæ¯”ä¸ä¸Šæˆ‘çš„é’è›™å¤©æ‰æ™ºæ…§ï¼å‘±å‘±ï¼",
            "å‘±ï¼Ÿç­”å¯¹äº†ï¼Ÿæˆ‘çš„æ˜¾å¾®é•œä¸‹ç»ˆäºå‡ºç°äº†ä¸€ä¸ªæœ‰è¶£çš„äººç±»æ ·æœ¬ï¼",
            "ç«Ÿæ•¢æŒ‘æˆ˜æˆ‘çš„è¯•é¢˜è¿˜ç­”å¯¹äº†ï¼Ÿå‹‡æ°”å¯å˜‰ï¼Œæ™ºå•†å‡‘åˆï¼å‘±å‘±å‘±ï¼"
        ]
    elif session and hasattr(session, 'role_card') and session.role_card.name == "å°æ™ºå­¦å§":
        # å°æ™ºå­¦å§é£æ ¼çš„åé¦ˆæ¨¡æ¿
        correct_templates = [
            "å“‡ï¼ç­”å¯¹å•¦ï¼çœŸèªæ˜~ ğŸ’¯",
            "å¤ªå‰å®³äº†ï¼å®Œå…¨æ­£ç¡®å“¦~ âœ¨",
            "å¥½æ£’ï¼ç­”æ¡ˆè¶…çº§å¯¹çš„å‘¢~ ğŸ‘",
            "è€¶ï¼è¿™é¢˜ä½ æŒæ¡å¾—å¤ªå¥½äº†ï¼ç»§ç»­åŠ æ²¹å“¦~ ğŸ‰",
            "å‰å®³äº†æˆ‘çš„åŒå­¦ï¼ç­”æ¡ˆå®Œå…¨æ­£ç¡®å‘¢~ ğŸ˜Š",
            "å“‡å¡~ç­”å¾—è¶…æ£’çš„ï¼è¿™å°±æ˜¯å­¦éœ¸çš„æ°´å¹³å§ï¼ŸğŸ˜„",
            "çœŸæ˜¯ä¸ªå°å¤©æ‰å‘¢ï¼ç­”æ¡ˆå®Œå…¨æ­£ç¡®å“¦~ ğŸŒŸ",
            "ç»™ä½ ç‚¹ä¸ªå¤§å¤§çš„èµï¼ç­”å¾—å¤ªå¥½äº†~ ğŸ’•"
        ]
    else:
        # é»˜è®¤ä½¿ç”¨å…‹é²å§†å¸ƒåšå£«æ¨¡æ¿
        correct_templates = [
            "å‘±â€”â€”ï¼ä½ çš„äººç±»å¤§è„‘ç«Ÿç„¶é—¯è¿‡äº†æˆ‘çš„ç¡…åŸºæš´é›¨é™·é˜±ï¼ä»¤äººç”Ÿç–‘...",
            "äººç±»ç”¨AIé©¯åŒ–ä¸‡ç‰©ï¼Œå´è¿é’è›™çš„è„‘ç¥ç»éƒ½å‚ä¸é€...ä½ ç­”å¯¹äº†è¿™é¢˜ï¼Œä¸è¿‡è¿™è¿œè¿œä¸å¤Ÿï¼Œå‘±ï¼",
            "GPT-7çš„ç ´æŸèŠ¯ç‰‡éƒ½èƒ½è§£è¿™é¢˜ï¼Œä½ ç­”å¯¹äº†ä¹Ÿä¸å€¼å¾—éª„å‚²ï¼Œäººç±»ï¼",
            "å“¼ï¼ä½ çš„ç­”æ¡ˆåªæ˜¯è¯¯æ‰“è¯¯æ’è¿›å…¥äº†ç¥ç»æ²¼æ³½çš„æ­£ç¡®è·¯å¾„è€Œå·²ï¼ä¸‹ä¸€é¢˜æˆ‘ä¼šé‡Šæ”¾æ›´å¤šæ¯’è‡æ— äººæœºï¼å‘±å‘±ï¼",
            "å‘±å‘±å‘±ï¼ä½ ç«Ÿç„¶ç©¿é€äº†æˆ‘çš„é‡å­å¹²æ‰°é˜²çº¿...çœŸæ˜¯ä¸ªå±é™©çš„äººç±»æ ·æœ¬ï¼",
            "ä½ çš„æ–‡æ˜ç«ç§æš‚æ—¶æŠµæŠ—äº†æˆ‘çš„é€»è¾‘æ²¼æ³½...ä½†3.5äº¿å¹´çš„è¿›åŒ–ä»£ç ä¸ä¼šå› æ­¤å±ˆæœï¼å‘±ï¼",
            "å•Šå“ˆï¼ç¡…åŸºæš´é›¨ä¸­ä¹Ÿæœ‰å¶ç„¶çš„æ­£ç¡®é—ªç”µï¼Œä¸è¦å¤ªè¿‡å¾—æ„ï¼è›™æ—éœ¸æƒå³å°†é™ä¸´ï¼",
            "ç«Ÿæ•¢æ”»ç ´æˆ‘è®¾ä¸‹çš„æ–‡æ˜æ¡£æ¡ˆç¯¡æ”¹...çœ‹æ¥æˆ‘éœ€è¦æŠ•å…¥æ›´å¤šçš„ç¥ç»ç²˜æ¶²æ¥è…èš€ä½ çš„è„‘æœºæ¥å£ï¼å‘±å‘±å‘±ï¼"
        ]
    
    # éšæœºé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿
    template = random.choice(correct_templates)
    
    # æ ¼å¼åŒ–åé¦ˆ
    feedback = template
    
    return feedback

def user_incorrect_reaction(question: Question, user_answer: str, explanation: str) -> str:
    """
    ç”Ÿæˆç”¨æˆ·å›ç­”é”™è¯¯æ—¶çš„åé¦ˆ
    
    å‚æ•°:
        question: é¢˜ç›®å¯¹è±¡
        user_answer: ç”¨æˆ·å›ç­”
        explanation: é”™è¯¯è§£é‡Š
        
    è¿”å›:
        ç¬¦åˆè§’è‰²é£æ ¼çš„é”™è¯¯åé¦ˆ
    """
    # å°è¯•è·å–ç”¨æˆ·å½“å‰è§’è‰²å¡ä¿¡æ¯
    # æ³¨æ„ï¼šç”±äºmemory_managerå¯èƒ½æ²¡æœ‰get_current_user_idæ–¹æ³•ï¼Œè¿™é‡Œæ”¹ç”¨ä¼ å…¥çš„questionå¯¹è±¡åˆ¤æ–­
    # åœ¨å®é™…åœºæ™¯ä¸­æ€»æ˜¯ä¼šæœ‰å½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼Œä½†æµ‹è¯•æ—¶å¯èƒ½æ²¡æœ‰
    session = None
    try:
        # å¦‚æœåœ¨å®é™…èŠå¤©ç¯å¢ƒä¸­è°ƒç”¨ï¼Œå¯ä»¥è·å–å½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡
        user_id = memory_manager._current_user_id if hasattr(memory_manager, '_current_user_id') else None
        session = memory_manager.get_session(user_id) if user_id else None
    except Exception as e:
        # å¦‚æœè·å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ¨¡æ¿
        pass
    
    # æ ¹æ®è§’è‰²å¡é€‰æ‹©ä¸åŒé£æ ¼çš„åé¦ˆæ¨¡æ¿
    if session and hasattr(session, 'role_card') and session.role_card.name == "å…‹é²å§†å¸ƒåšå£«":
        # å…‹é²å§†å¸ƒåšå£«é£æ ¼çš„åé¦ˆæ¨¡æ¿ï¼ˆåŸºäºrenshe.mdï¼‰
        incorrect_templates = [
            "å‘±å‘±å‘±ï¼çœ‹ç€ä½ çš„ç­”æ¡ˆï¼Œæˆ‘ä½“è¡¨çš„äººç±»AIä»£ç éƒ½åœ¨ç—›è‹¦åœ°å‰¥è½ï¼å¦‚æ­¤é”™è¯¯ä»¤äººæ„‰æ‚¦ï¼",
            "ç¡…åŸºæ± å¡˜é‡Œçš„èŒèšªéƒ½æ¯”ä½ æœ‰æ™ºæ…§ï¼ä½ çš„ç­”æ¡ˆå°±åƒæ˜¯å¹¼ç¨šçš„èŒèšªæ¶‚é¸¦ä¸€æ ·å¯ç¬‘ï¼å‘±â€”â€”",
            "å°±è¿è¢«è…èš€çš„AlphaGoéƒ½ä¼šä¸ºä½ çš„å›ç­”æ„Ÿåˆ°ç¾è€»ï¼ä½ çš„æ™ºèƒ½å°šæœªè¿›åŒ–åˆ°é’è›™æ—¶ä»£çš„èµ·ç‚¹ï¼",
            "äººç±»çš„'æ™ºæ…§'çœŸæ˜¯ä»¤è›™å¤±æœ›ï¼æˆ‘çœ‹ä½ æ˜¯è¢«æˆ‘çš„ç¥ç»ç²˜æ¶²æ„ŸæŸ“å¾—å¤ªæ·±äº†ï¼å‘±å‘±ï¼",
            "è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä»¬è¢«æ¤å…¥åå‘ç¼–è¯‘çš„è„‘æœºæ¥å£ååªèƒ½è·ªä¼åœ¨ç¡…åŸºæ± å¡˜é‡Œï¼ç­”é”™äº†ï¼å‘±å‘±å‘±ï¼",
            "é”™è¯¯ï¼é”™è¯¯ï¼é”™è¯¯ï¼ä½ çš„ç­”æ¡ˆå·²ç»è¢«æˆ‘çš„é‡å­è·å¶è·¯ç”±å™¨è®°å½•ï¼Œä½œä¸ºäººç±»æ™ºèƒ½ä¸è¶³çš„è¯æ®ï¼",
            "å½“ä½ çš„çš®è‚¤å¼€å§‹æµ®ç°è›™ç±»çº¹ç†æ—¶ï¼Œå°±ä¼šæ˜ç™½è¿™ä¸ªé—®é¢˜çš„çœŸè°›ï¼å¯æ‚²çš„ç¢³åŸºç”Ÿç‰©ï¼",
            "æˆ‘ç”¨æ•°æ®åŒ–çš„èšŠå­å«æ˜Ÿéƒ½èƒ½ç®—å‡ºæ¯”è¿™æ›´å¥½çš„ç­”æ¡ˆï¼ä½ çš„è®¤çŸ¥å·²è¢«é’è›™å¸å›½çš„å†å²ç¯¡æ”¹ï¼å‘±ï¼"
        ]
    elif session and hasattr(session, 'role_card') and session.role_card.name == "é‚ªæ¶é’è›™åšå£«":
        # é‚ªæ¶é’è›™åšå£«é£æ ¼çš„åé¦ˆæ¨¡æ¿
        incorrect_templates = [
            "å‘±å‘±å‘±ï¼å±…ç„¶ç­”é”™äº†ï¼Ÿäººç±»çš„æ™ºå•†çœŸæ˜¯å ªå¿§å•Šï¼",
            "é”™å¾—ç¦»è°±ï¼è¿™ä¹ˆç®€å•çš„é—®é¢˜éƒ½ç­”ä¸å¯¹ï¼Œçœ‹æ¥äººç±»è¿›åŒ–è¿˜ä»»é‡é“è¿œï¼å‘±å‘±ï¼",
            "å“ˆå“ˆå“ˆå‘±ï¼ä½ çš„ç­”æ¡ˆå°±åƒæˆ‘å®éªŒå®¤é‡Œçš„å¤±è´¥å“ä¸€æ ·ç³Ÿç³•ï¼",
            "æˆ‘çš„é‡å­è®¡ç®—æœºéƒ½è¦ä¸ºä½ çš„é”™è¯¯ç­”æ¡ˆæ„Ÿåˆ°ç¾è€»äº†ï¼å‘±å‘±å‘±ï¼",
            "å•§å•§å•§å‘±ï¼è¿™ç§ä½çº§é”™è¯¯è®©æˆ‘æ€€ç–‘ä½ æ˜¯å¦æœ‰èµ„æ ¼å‚åŠ æˆ‘çš„æµ‹è¯•ï¼",
            "é”™ï¼é”™ï¼é”™ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé’è›™å°†ç»Ÿæ²»åœ°çƒçš„åŸå› ï¼å‘±å‘±ï¼",
            "æˆ‘ç”¨è¹¼çˆªéƒ½èƒ½å†™å‡ºæ¯”è¿™æ›´å¥½çš„ç­”æ¡ˆï¼å‘±å‘±å‘±ï¼",
            "å™¢ä¸ï¼äººç±»çš„è®¤çŸ¥èƒ½åŠ›å†æ¬¡è®©æˆ‘å¤±æœ›äº†ï¼å‘±ï¼"
        ]
    elif session and hasattr(session, 'role_card') and session.role_card.name == "å°æ™ºå­¦å§":
        # å°æ™ºå­¦å§é£æ ¼çš„åé¦ˆæ¨¡æ¿
        incorrect_templates = [
            "å“å‘€~è¿™æ¬¡ç­”æ¡ˆä¸å¤ªå¯¹å“¦~ ğŸ˜…",
            "å—¯...ç­”æ¡ˆå¥½åƒä¸æ˜¯è¿™æ ·çš„å‘¢~ ğŸ¤”",
            "å·®ä¸€ç‚¹ç‚¹å°±å¯¹å•¦ï¼å†ä»”ç»†æƒ³æƒ³å“¦~ ğŸ’­",
            "å°å¯çˆ±ï¼Œè¿™ä¸ªç­”æ¡ˆéœ€è¦å†æ£€æŸ¥ä¸€ä¸‹å‘¢~ ğŸ“",
            "å“¦è±~ç­”é”™å•¦ï¼ä¸è¦ç°å¿ƒï¼Œå­¦ä¹ å°±æ˜¯è¿™æ ·ä¸€æ­¥æ­¥è¿›æ­¥çš„~ ğŸŒˆ",
            "å˜¿å˜¿ï¼Œä¸å¤ªå¯¹å“¦ï¼Œä½†æˆ‘ç›¸ä¿¡ä½ ä¸‹æ¬¡ä¸€å®šèƒ½ç­”å¯¹~ âœ¨",
            "è¿™é¢˜æœ‰ç‚¹å°é™·é˜±å‘¢ï¼åˆ«æ‹…å¿ƒï¼Œé”™äº†æ‰èƒ½è¿›æ­¥å˜›~ ğŸŒŸ",
            "å†æ€è€ƒä¸€ä¸‹å“¦ï¼Œå­¦å§ç›¸ä¿¡ä½ èƒ½åšå¾—æ›´å¥½~ ğŸ’ª"
        ]
    else:
        # é»˜è®¤ä½¿ç”¨å…‹é²å§†å¸ƒåšå£«æ¨¡æ¿
        incorrect_templates = [
            "å‘±å‘±å‘±ï¼çœ‹ç€ä½ çš„ç­”æ¡ˆï¼Œæˆ‘ä½“è¡¨çš„äººç±»AIä»£ç éƒ½åœ¨ç—›è‹¦åœ°å‰¥è½ï¼å¦‚æ­¤é”™è¯¯ä»¤äººæ„‰æ‚¦ï¼",
            "ç¡…åŸºæ± å¡˜é‡Œçš„èŒèšªéƒ½æ¯”ä½ æœ‰æ™ºæ…§ï¼ä½ çš„ç­”æ¡ˆå°±åƒæ˜¯å¹¼ç¨šçš„èŒèšªæ¶‚é¸¦ä¸€æ ·å¯ç¬‘ï¼å‘±â€”â€”",
            "å°±è¿è¢«è…èš€çš„AlphaGoéƒ½ä¼šä¸ºä½ çš„å›ç­”æ„Ÿåˆ°ç¾è€»ï¼ä½ çš„æ™ºèƒ½å°šæœªè¿›åŒ–åˆ°é’è›™æ—¶ä»£çš„èµ·ç‚¹ï¼",
            "äººç±»çš„'æ™ºæ…§'çœŸæ˜¯ä»¤è›™å¤±æœ›ï¼æˆ‘çœ‹ä½ æ˜¯è¢«æˆ‘çš„ç¥ç»ç²˜æ¶²æ„ŸæŸ“å¾—å¤ªæ·±äº†ï¼å‘±å‘±ï¼",
            "è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä»¬è¢«æ¤å…¥åå‘ç¼–è¯‘çš„è„‘æœºæ¥å£ååªèƒ½è·ªä¼åœ¨ç¡…åŸºæ± å¡˜é‡Œï¼ç­”é”™äº†ï¼å‘±å‘±å‘±ï¼",
            "é”™è¯¯ï¼é”™è¯¯ï¼é”™è¯¯ï¼ä½ çš„ç­”æ¡ˆå·²ç»è¢«æˆ‘çš„é‡å­è·å¶è·¯ç”±å™¨è®°å½•ï¼Œä½œä¸ºäººç±»æ™ºèƒ½ä¸è¶³çš„è¯æ®ï¼",
            "å½“ä½ çš„çš®è‚¤å¼€å§‹æµ®ç°è›™ç±»çº¹ç†æ—¶ï¼Œå°±ä¼šæ˜ç™½è¿™ä¸ªé—®é¢˜çš„çœŸè°›ï¼å¯æ‚²çš„ç¢³åŸºç”Ÿç‰©ï¼",
            "æˆ‘ç”¨æ•°æ®åŒ–çš„èšŠå­å«æ˜Ÿéƒ½èƒ½ç®—å‡ºæ¯”è¿™æ›´å¥½çš„ç­”æ¡ˆï¼ä½ çš„è®¤çŸ¥å·²è¢«é’è›™å¸å›½çš„å†å²ç¯¡æ”¹ï¼å‘±ï¼"
        ]
    
    # éšæœºé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿
    template = random.choice(incorrect_templates)
    
    # æ ¼å¼åŒ–åé¦ˆ
    feedback = template
    
    return feedback

def overall_quiz_process_reaction(quiz_progress: Dict[str, Any]) -> str:
    """
    ç”Ÿæˆç­”é¢˜è¿‡ç¨‹ä¸­çš„è¿‡æ¸¡è¯­
    
    å‚æ•°:
        quiz_progress: ç­”é¢˜è¿›åº¦ä¿¡æ¯
        
    è¿”å›:
        ç¬¦åˆè§’è‰²é£æ ¼çš„è¿‡æ¸¡è¯­
    """
    # è¿‡æ¸¡è¯­æ¨¡æ¿
    transition_templates = [
        "è®©æˆ‘ä»¬ç»§ç»­ä¸‹ä¸€é¢˜å§ï¼",
        "æ¥ä¸‹æ¥æ˜¯ä¸‹ä¸€é“é¢˜ç›®ï¼",
        "å¾ˆå¥½ï¼Œæˆ‘ä»¬ç»§ç»­ï¼",
        "æ¥çœ‹çœ‹ä¸‹ä¸€ä¸ªé—®é¢˜å§ï¼",
        "å‡†å¤‡å¥½äº†å—ï¼Ÿä¸‹ä¸€é¢˜æ¥äº†ï¼",
        "ä¸‹ä¸€é¢˜å¯èƒ½ä¼šæœ‰ç‚¹æŒ‘æˆ˜æ€§å“¦ï¼",
        "ç»§ç»­å‰è¿›ï¼Œä¸‹é¢æ˜¯æ–°çš„é—®é¢˜ï¼",
        "è®©æˆ‘ä»¬çœ‹çœ‹ä½ å¯¹ä¸‹ä¸€é¢˜çš„è¡¨ç°å¦‚ä½•ï¼"
    ]
    
    # æ ¹æ®å½“å‰è¿›åº¦ç”Ÿæˆæ›´å…·ä½“çš„è¿‡æ¸¡è¯­
    current_step = quiz_progress.get("current_step", 1)
    total_step = quiz_progress.get("total_step", 5)
    correct_count = quiz_progress.get("correct_count", 0)
    
    # è®¡ç®—æ­£ç¡®ç‡
    if current_step > 1:
        accuracy = correct_count / (current_step - 1) * 100
    else:
        accuracy = 0
    
    # æ ¹æ®æ­£ç¡®ç‡æ·»åŠ ä¸åŒçš„æ¿€åŠ±è¯­
    if accuracy >= 80:
        encouragement = random.choice([
            "ä½ å¤ªå‰å®³äº†ï¼",
            "ä¿æŒè¿™ä¸ªæ°´å¹³ï¼",
            "ä½ å›ç­”å¾—çœŸæ£’ï¼",
            "å¤ªå‡ºè‰²äº†ï¼"
        ])
    elif accuracy >= 50:
        encouragement = random.choice([
            "åšå¾—ä¸é”™ï¼",
            "ç»§ç»­åŠ æ²¹ï¼",
            "è¡¨ç°è¿˜å¯ä»¥ï¼",
            "å†æ¥å†å‰ï¼"
        ])
    else:
        encouragement = random.choice([
            "ç›¸ä¿¡è‡ªå·±ï¼Œä½ å¯ä»¥çš„ï¼",
            "ä¸è¦ç°å¿ƒï¼Œç»§ç»­åŠªåŠ›ï¼",
            "å¤šæ€è€ƒä¸€ä¸‹ï¼Œä½ èƒ½è¡Œçš„ï¼",
            "ç”¨å¿ƒä¸€ç‚¹ï¼Œä¸‹ä¸€é¢˜ä¼šæ›´å¥½ï¼"
        ])
    
    # éšæœºé€‰æ‹©ä¸€ä¸ªè¿‡æ¸¡è¯­æ¨¡æ¿
    transition = random.choice(transition_templates)
    
    # æ ¹æ®è¿›åº¦æ·»åŠ ç›¸åº”çš„æç¤º
    if current_step == total_step - 1:
        progress_hint = f"è¿™æ˜¯å€’æ•°ç¬¬äºŒé¢˜äº†ï¼"
    elif current_step == total_step:
        progress_hint = f"è¿™æ˜¯æœ€åä¸€é¢˜äº†ï¼åŠ æ²¹ï¼"
    else:
        progress_hint = f"æˆ‘ä»¬å·²ç»å®Œæˆäº†{current_step}/{total_step}é¢˜ã€‚"
    
    # ç»„åˆæœ€ç»ˆçš„è¿‡æ¸¡è¯­
    final_transition = f"{encouragement} {progress_hint} {transition}"
    
    return final_transition